<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scoreboard para el Concurso de Remix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        label {
            margin-bottom: 8px;
            font-weight: bold;
            width: 100%;
            text-align: left;
        }
        input[type="text"], input[type="url"], textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
        }
        input[type="submit"] {
            width: 100%;
            padding: 12px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        input[type="submit"]:hover {
            background-color: #0056b3;
        }

        /* Estilo para la barra de temperatura */
        .progress-bar {
            margin-top: 20px;
            position: relative;
            width: 100%;
            height: 50px;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: inset 0 -4px 8px rgba(0, 0, 0, 0.1);
        }
        .progress-bar .bar {
            height: 100%;
            background: linear-gradient(to right, #00f, #0f0, #ff0, #f00); /* Gradiente de colores */
            border-radius: 25px;
        }
        .progress-bar .fill {
            height: 100%;
            background: #f00; /* Color inicial */
            transition: width 0.3s ease;
            border-radius: 25px;
        }
        .progress-bar .scale {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            color: #333;
        }
        .progress-bar .scale span {
            position: relative;
            bottom: -5px; /* Ajuste vertical */
        }
        .progress-bar .indicator {
            position: absolute;
            bottom: -40px; /* Distancia entre el triángulo y la barra */
            left: 0;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: left 0.3s ease;
        }
        .progress-bar .indicator .triangle {
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 12px 12px 12px;
            border-color: transparent transparent #000 transparent;
        }
        .progress-bar .indicator .score-label {
            margin-top: 5px;
            font-size: 16px;
            font-weight: bold;
            color: #000;
        }

        /* Estilo para la tabla pública */
        .public-scores {
            margin-top: 100px;
            width: 100%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }
        th {
            background-color: #f9f9f9;
            color: #333;
        }
        a {
            color: #007BFF;
            text-decoration: none;
            font-weight: bold;
        }
        a:hover {
            text-decoration: underline;
        }
        .message {
            margin-top: 20px;
            text-align: center;
            font-size: 16px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>IMPACTOMETRO</h1>

        <form id="actionForm">
            <!-- User Identification -->
            <label for="username">Nombre de Usuario:</label>
            <input type="text" id="username" name="username" placeholder="Ingresa tu nombre">

            <!-- Deadline Configurable by Admin -->
            <label for="deadline">Fecha Límite:</label>
            <input type="text" id="deadline" value="2025-03-10" readonly style="background-color: #f9f9f9;"> <!-- ADMIN: FECHA LÍMITE DEL PROTOTIPO PONER AQUI "YYYY-MM-DD" -->

            <!-- Activity Title -->
            <label for="activityTitle">Título de la Buena Acción:</label>
            <input type="text" id="activityTitle" name="activityTitle" placeholder="Título de la buena acción"> <!-- ADMIN: EL TÍTULO DEBE SER PROGRAMADO POR EL ADMIN -->

            <!-- Description -->
            <label for="description">Descripción:</label>
            <textarea id="description" name="description" rows="4" placeholder="Describe lo que has logrado"></textarea>

            <!-- Verification Link -->
            <label for="verificationLink">Enlace de Verificación (Público):</label>
            <input type="url" id="verificationLink" name="verificationLink" placeholder="URL de comprobación">

            <!-- Submit Button -->
            <input type="submit" value="Enviar">
        </form>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="bar">
                <div class="fill" id="progressFill" style="width: 0%;"></div>
            </div>
            <div class="scale">
                <span>0.00</span><span style="margin-left: 11%;">0.25</span><span style="margin-left: 11%;">0.50</span>
                <span style="margin-left: 11%;">0.75</span><span style="margin-left: 11%;">1.00</span>
            </div>
            <div class="indicator" id="progressIndicator" style="left: 0;">
                <div class="triangle"></div>
                <div class="score-label" id="scoreLabel">0.00</div> <!-- Mostrar puntaje inicial -->
            </div>
        </div>

        <!-- Public Scores Table -->
        <div class="public-scores">
            <h2>Puntuaciones Públicas</h2>
            <table>
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Título</th>
                        <th>Impact</th>
                        <th>Score</th>
                        <th>Verification</th>
                    </tr>
                </thead>
                <tbody id="publicScoresTable">
                    <!-- Scores will be dynamically added here -->
                </tbody>
            </table>
        </div>

        <!-- Message after submission -->
        <div class="message" id="thankYouMessage" style="display: none;">
            ¡Gracias por tus buenas acciones! Tu progreso se ha actualizado.
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const actionForm = document.getElementById('actionForm');
            if (!actionForm) {
                console.error("El formulario con ID 'actionForm' no fue encontrado en el DOM.");
                return;
            }

            const progressFill = document.getElementById('progressFill');
            const progressIndicator = document.getElementById('progressIndicator');
            const scoreLabel = document.getElementById('scoreLabel');

            // ADMIN: DEFINE AQUÍ LAS BUENAS ACCIONES Y SUS REGLAS DE PUNTUACIÓN
            const validActions = [
                { 
                    title: "el ping tag", // ADMIN: TÍTULO ÚNICO DE LA BUENA ACCIÓN PONER AQUI "TU_TITULO"
                    pointsConfig: {
                        username: 0.25, // ADMIN: PUNTOS POR NOMBRE DE USUARIO PONER AQUI 0.25
                        descriptionWords: {
                            minWords: 10, // ADMIN: NÚMERO MÍNIMO DE PALABRAS EN LA DESCRIPCIÓN PONER AQUI 10
                            pointsForMinWords: 0.25, // ADMIN: PUNTOS SI HAY MÁS DE MINWORDS PONER AQUI 0.25
                        },
                        verificationLink: 0.5 // ADMIN: PUNTOS POR ENLACE DE VERIFICACIÓN PONER AQUI 0.5
                    }
                },
                { 
                    title: "el ping tag", // ADMIN: TÍTULO ÚNICO DE LA BUENA ACCIÓN PONER AQUI "TU_TITULO"
                    pointsConfig: {
                        username: 0.25, // ADMIN: PUNTOS POR NOMBRE DE USUARIO PONER AQUI 0.25
                        descriptionWords: {
                            minWords: 15, // ADMIN: NÚMERO MÍNIMO DE PALABRAS EN LA DESCRIPCIÓN PONER AQUI 15
                            pointsForMinWords: 0.25, // ADMIN: PUNTOS SI HAY MÁS DE MINWORDS PONER AQUI 0.25
                        },
                        verificationLink: 0.5 // ADMIN: PUNTOS POR ENLACE DE VERIFICACIÓN PONER AQUI 0.5
                    }
                },
                { 
                    title: "elpingtag", // ADMIN: TÍTULO ÚNICO DE LA BUENA ACCIÓN PONER AQUI "TU_TITULO"
                    pointsConfig: {
                        username: 0.25, // ADMIN: PUNTOS POR NOMBRE DE USUARIO PONER AQUI 0.25
                        descriptionWords: {
                            minWords: 5, // ADMIN: NÚMERO MÍNIMO DE PALABRAS EN LA DESCRIPCIÓN PONER AQUI 5
                            pointsForMinWords: 0.25, // ADMIN: PUNTOS SI HAY MÁS DE MINWORDS PONER AQUI 0.25
                        },
                        verificationLink: 0.5 // ADMIN: PUNTOS POR ENLACE DE VERIFICACIÓN PONER AQUI 0.5
                    }
                }
            ];

            // Cargar puntuaciones públicas desde localStorage
            function loadPublicScores() {
                const savedScores = JSON.parse(localStorage.getItem('publicScores')) || [];
                const publicScoresTable = document.getElementById('publicScoresTable');
                publicScoresTable.innerHTML = ''; // Limpiar la tabla antes de cargar los datos

                savedScores.forEach(score => {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${score.username}</td>
                        <td>${score.activityTitle}</td>
                        <td>${score.impactStatus}</td>
                        <td>${score.points.toFixed(2)}</td>
                        <td><a href="${score.verificationLink}" target="_blank">${score.verificationLink ? 'Verificar' : 'Sin Enlace'}</a></td>
                    `;
                    publicScoresTable.appendChild(newRow);
                });
            }

            // Guardar puntuaciones públicas en localStorage
            function savePublicScores(scores) {
                localStorage.setItem('publicScores', JSON.stringify(scores));
            }

            // Obtener todas las puntuaciones públicas actuales
            function getPublicScores() {
                return JSON.parse(localStorage.getItem('publicScores')) || [];
            }

            // Verificar si un usuario ya ha enviado una buena acción específica
            function isUserActionAlreadySubmitted(username, activityTitle) {
                const scores = getPublicScores();
                return scores.some(score => 
                    score.username.toLowerCase().trim() === username.toLowerCase().trim() &&
                    score.activityTitle.toLowerCase().trim() === activityTitle.toLowerCase().trim()
                );
            }

            // Verificar si un enlace de verificación ya existe en cualquier registro
            function isVerificationLinkUsed(verificationLink) {
                const scores = getPublicScores();
                return scores.some(score => score.verificationLink === verificationLink);
            }

            loadPublicScores(); // Cargar puntuaciones al iniciar la aplicación

            actionForm.addEventListener('submit', function (event) {
                event.preventDefault();

                const deadlineInput = document.getElementById('deadline');
                const deadlineStr = deadlineInput.value || "2023-03-10"; // ADMIN: FECHA LÍMITE DEL PROTOTIPO PONER AQUI "YYYY-MM-DD"
                const deadlineDate = new Date(deadlineStr);

                const currentDate = new Date();
                if (currentDate > deadlineDate) {
                    alert("La fecha límite ha expirado. No puedes enviar más acciones.");
                    return;
                }

                const formData = new FormData(this);
                const username = formData.get('username') || 'Anónimo';
                const activityTitle = formData.get('activityTitle') || '';
                const description = formData.get('description') || '';
                const verificationLink = formData.get('verificationLink') || '';

                // Validar si el título es válido y programado por el admin
                const matchingAction = validActions.find(action => 
                    activityTitle.toLowerCase().trim() === action.title.toLowerCase().trim()
                );

                if (!matchingAction) {
                    alert("El título de la buena acción no es válido. Debe coincidir con uno programado por el administrador.");
                    return;
                }

                // Verificar si el usuario ya ha enviado esta buena acción
                if (isUserActionAlreadySubmitted(username, activityTitle)) {
                    alert("Ya has enviado esta buena acción. No puedes enviarla nuevamente.");
                    return;
                }

                // Verificar si el enlace de verificación ya existe en cualquier registro
                if (isVerificationLinkUsed(verificationLink)) {
                    alert("Este enlace de verificación ya ha sido registrado. Debes proporcionar uno diferente.");
                    return;
                }

                // Calcular puntos basados en la buena acción
                const pointsConfig = matchingAction.pointsConfig;
                let pointsForAction = 0;

                // Puntos por nombre de usuario
                if (username.trim() !== '') {
                    pointsForAction += pointsConfig.username;
                }

                // Puntos por descripción
                const wordCount = description.trim().split(' ').length;
                if (wordCount >= pointsConfig.descriptionWords.minWords) {
                    pointsForAction += pointsConfig.descriptionWords.pointsForMinWords;
                } else {
                    alert(`Tu descripción debe contener al menos ${pointsConfig.descriptionWords.minWords} palabras.`);
                    return;
                }

                // Puntos por enlace de verificación
                if (verificationLink.trim() !== '') {
                    pointsForAction += pointsConfig.verificationLink;
                }

                // Determinar el estado (Impact)
                const impactStatus = pointsForAction === 1 ? "Excelente" : pointsForAction >= 0.75 ? "Muy Bueno" : pointsForAction >= 0.5 ? "Bueno" : "Pobre";

                // Crear nueva fila en la tabla de puntuaciones públicas
                const newRow = {
                    username,
                    activityTitle,
                    impactStatus,
                    points: pointsForAction.toFixed(2),
                    verificationLink
                };

                // Guardar la nueva puntuación en localStorage
                const publicScores = getPublicScores();
                publicScores.push(newRow);
                savePublicScores(publicScores);

                // Actualizar la tabla pública
                const publicScoresTable = document.getElementById('publicScoresTable');
                const rowElement = document.createElement('tr');
                rowElement.innerHTML = `
                    <td>${newRow.username}</td>
                    <td>${newRow.activityTitle}</td>
                    <td>${newRow.impactStatus}</td>
                    <td>${newRow.points}</td>
                    <td><a href="${newRow.verificationLink}" target="_blank">${newRow.verificationLink ? 'Verificar' : 'Sin Enlace'}</a></td>
                `;
                publicScoresTable.appendChild(rowElement);

                // Mostrar confeti si alcanza la puntuación máxima de la acción
                if (pointsForAction === 1) {
                    showConfetti();
                }

                // Mostrar mensaje de agradecimiento
                const thankYouMessage = document.getElementById('thankYouMessage');
                thankYouMessage.style.display = 'block';
                setTimeout
